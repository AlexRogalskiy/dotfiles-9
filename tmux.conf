# Usage, inside tmux (note, my Prefix is Ctrl-w):
#   Prefix-c: create a new window
#   Prefix-1/2/3/4...: change to numbered window
#   Prefix-d: detach session
#   Prefix-x: kill a window
#   Prefix-|: create vertical pane
#   Prefix--: create horizontal pane
#   Ctrl-h/j/k/l: navigate between panes, including Vim splits if Vim Tmux
#                 Navigator has been configured.
#   Prefix-y: toggle "synchronize" to all panes of the current windows
#   Prefix-<UP>/<DOWN>: move panes around current window.
#   Prefix-a: rename the current window
#   Prefix-z: toggle pane zoom between full window size and normal pane size.
#
# Usage, copy and paste inside tmux:
#   Prefix-ESCAPE: enter copy mode, use vi keys for navigation (h,j,k,l,g,G,/,?)
#   v: start selection
#   y or Enter: end selection
#   Prefix-p: paste selection
#   Prefix-=: view all copy buffers and pastes selection
#
#   Note, hold "Shift" if one wishes to copy and paste into or out-of tmux
#   using mouse selections.
#
# Usage, at command line:
#   tmux new -s foglamp: create a new session named foglamp
#   tnew: bash alias to create a session named using the current directory
#   tmux ls: list active sessions
#   tmux attach: attach to first active session
#   tmux attach -t foglamp: attach to session named "foglamp".


#============================
# Configuration
#============================

# Change the default prefix.
unbind C-b
set -g prefix C-w

# Enable 256 color support.
set -g default-terminal "screen-256color"

# Needed for Vim CTRL-Left/Right to work.
setw -g xterm-keys on

# Allow xterm to scroll using Shift-[Arrow/Page Up/Down]. Note, this works best
# for tmux windows with only no splits.
set -g terminal-overrides 'xterm*:smcup@:rmcup@'

# Set the status bar attributes.
set -g status-left-length 40
set -g status-interval 30
set -g status-utf8 on

# Make Vim more responsive.
set -sg escape-time 0

# Increase scroll back limit.
set -g history-limit 9999

# Use vi key bindings in copy mode.
setw -g mode-keys vi

# Window and pane numbering should be 1-based.
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed.
set -g renumber-windows on

# Highlight window when it has new activity but don't flash the status line.
setw -g monitor-activity on
set -g visual-activity off

# Enable mouse support.
set -g mouse on
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= \"#{pane_in_mode}\" \"send-keys -M\" \"select-pane -t=; copy-mode -e; send-keys -M\""
bind -n WheelDownPane select-pane -t= \; send-keys -M

#============================
# Bindings
#============================

# Use Vim style commands for copy and paste. See "Usage, copy and paste" above.
unbind [
bind Escape copy-mode
unbind p
bind p paste-buffer
bind -t vi-copy v begin-selection
# Copy tmux selection to system clipboard. Different mechanisms are needed for
# Linux and Mac. Allow both Enter and 'y' (for yank) to signify end selection.
if-shell 'case "$OS" in *Linux*) true;; *) false;; esac' \
    'bind -t vi-copy Enter copy-pipe "xclip -selection clipboard -i"' \
    'bind -t vi-copy Enter copy-pipe "reattach-to-user-namespace pbcopy"'
if-shell 'case "$OS" in *Linux*) true;; *) false;; esac' \
    'bind -t vi-copy y copy-pipe "xclip -selection clipboard -i"' \
    'bind -t vi-copy y copy-pipe "reattach-to-user-namespace pbcopy"'

# Reload tmux.conf via Prefix-r.
bind r source-file ~/.tmux.conf \; display "Reloaded ~/.tmux.conf"

# Nicer split window bindings.
unbind %
bind | split-window -h
unbind '"'
bind - split-window -v

# Smart pane navigation including awareness of Vim splits when using "Vim Tmux
# Navigator" plugin.
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)g?(view|n?vim?x?)(diff)?$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
# Vim style pane navigation using Prefix-<h/j/k/l> for platforms where "Vim
# Tmux Navigator" does not work (e.g Cygwin).
#bind h select-pane -L
#bind j select-pane -D
#bind k select-pane -U
#bind l select-pane -R

# Synchronize all panes in the current window.
bind y setw synchronize-panes

# Rename the current window.
bind a command-prompt "rename-window %%"

# Pane resizing.
bind -r H resize-pane -L 15
bind -r J resize-pane -D 15
bind -r K resize-pane -U 15
bind -r L resize-pane -R 15

# Move panes around the current window. Use Prefix-q to list pane numbers.
bind up swap-pane -D
bind down swap-pane -U

#============================
# Style
#============================

# Set status line, windows, pane and message colors.
set -g status-bg colour235
set -g status-fg colour248
setw -g window-status-current-fg colour114
setw -g window-status-current-bg colour235
set -g pane-border-fg colour236
set -g pane-border-bg colour232
set -g pane-active-border-fg colour110
set -g pane-active-border-bg colour232
set -g message-fg colour235
set -g message-bg colour144
set-option -gw window-status-activity-bg colour235
set-option -gw window-status-activity-fg colour216
set-option -gw window-status-activity-attr none

# Set status bar components and style.
set -g status-left "#[bg=colour235]#[fg=colour111][#S@#h] "
if-shell 'case "$OS" in *Linux*) true;; *) false;; esac' \
    'set -g status-right "#[bg=colour235]#[fg=colour174]%a %I:%M%P"' \
    'set -g status-right "#[bg=colour235]#[fg=colour174]%a %I:%M%p"' \
