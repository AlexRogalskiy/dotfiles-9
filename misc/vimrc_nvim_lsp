" See:
"  https://nathansmith.io/posts/neovim-lsp
"  https://rishabhrd.github.io/jekyll/update/2020/09/19/nvim_lsp_config.html
"  https://neovim.io/doc/user/lsp.html
"  https://github.com/scalameta/nvim-metals
"  https://github.com/scalameta/nvim-metals/blob/master/nvim-lsp.vim

Plug 'neovim/nvim-lspconfig'
Plug 'nvim-lua/completion-nvim'

let g:completion_enable_auto_hover      = 0
let g:completion_enable_auto_signature  = 0
let g:completion_trigger_keyword_length = 3
let g:completion_sorting                = 'alphabet'
let g:completion_matching_strategy_list = ['exact']
let g:completion_timer_cycle            = 200

nnoremap <silent> gd  <cmd>lua vim.lsp.buf.definition()<CR>
nnoremap <silent> K   <cmd>lua vim.lsp.buf.hover()<CR>
nnoremap <silent> gr  <cmd>lua vim.lsp.buf.references()<CR>
nnoremap <silent> gR  <cmd>lua vim.lsp.buf.rename()<CR>
nnoremap <silent> ga  <cmd>lua vim.lsp.buf.code_action()<CR>
nnoremap <silent> gh  <cmd>lua vim.lsp.buf.signature_help()<CR>

lua << EOF
  local lsp        = require'nvim_lsp'
  local completion = require'completion'

  lsp.dartls.setup {
    on_attach = completion.on_attach
  }

  lsp.solargraph.setup {
    on_attach = completion.on_attach
  }

  lsp.tsserver.setup {
    on_attach = completion.on_attach
  }

  vim.lsp.callbacks["textDocument/publishDiagnostics"] = function() end
EOF
